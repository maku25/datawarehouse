CREATE TABLE DIM_COMMERCE (
    COMMERCE_ID VARCHAR2(22) PRIMARY KEY,
    GEO_ID NUMBER, -- Lien vers DIM_GEOGRAPHIE
    NOM VARCHAR2(255) NOT NULL,
    CATEGORIES VARCHAR2(1000),
    EST_OUVERT NUMBER(1) CHECK (EST_OUVERT IN (0, 1)),
    NOTE_MOYENNE_SOURCE NUMBER(3,2),
    NB_AVIS_SOURCE NUMBER(10),
    GAMME_PRIX NUMBER(1),
    WIFI VARCHAR2(20),
    ALCOOL VARCHAR2(50),
    PARKING_GARAGE NUMBER(1) CHECK (PARKING_GARAGE IN (0, 1)),
    PARKING_RUE NUMBER(1) CHECK (PARKING_RUE IN (0, 1)),
    ACCEPTE_CB NUMBER(1) CHECK (ACCEPTE_CB IN (0, 1)),
    TERRASSE NUMBER(1) CHECK (TERRASSE IN (0, 1)),
    MENU_VEGE NUMBER(1) CHECK (MENU_VEGE IN (0, 1)),
    ADAPTE_ENFANTS NUMBER(1) CHECK (ADAPTE_ENFANTS IN (0, 1)),
    LIVRAISON NUMBER(1) CHECK (LIVRAISON IN (0, 1)),
    VENTE_A_EMPORTER NUMBER(1) CHECK (VENTE_A_EMPORTER IN (0, 1)),
    ACCES_HANDICAPE NUMBER(1) CHECK (ACCES_HANDICAPE IN (0, 1)),
    CONSTRAINT FK_COMMERCE_GEO FOREIGN KEY (GEO_ID) REFERENCES DIM_GEOGRAPHIE(GEO_ID)
);

CREATE TABLE DIM_GEOGRAPHIE (
    GEO_ID NUMBER PRIMARY KEY, 
    ADRESSE VARCHAR2(255),
    VILLE VARCHAR2(100) NOT NULL,
    ETAT VARCHAR2(50),
    CODE_POSTAL VARCHAR2(20),
    LATITUDE NUMBER,
    LONGITUDE NUMBER
);

CREATE TABLE DIM_UTILISATEUR (
    USER_ID VARCHAR2(22) PRIMARY KEY,
    NOM VARCHAR2(255),
    DATE_INSCRIPTION DATE,
    NB_AVIS_TOTAL NUMBER(10),
    NB_FANS NUMBER(10),
    NOTE_MOY_DONNEE NUMBER(3,2),
    EST_ELITE NUMBER(1) CHECK (EST_ELITE IN (0, 1)),
    NB_ANNEES_ELITE NUMBER(5) DEFAULT 0
);

CREATE TABLE DIM_TEMPS (
    DATE_ID NUMBER PRIMARY KEY, -- Format YYYYMMDD (ex: 20240207)
    DATE_COMPLETE DATE NOT NULL,
    ANNEE NUMBER(4) NOT NULL,
    TRIMESTRE NUMBER(1) NOT NULL,
    MOIS NUMBER(2) NOT NULL,
    NOM_MOIS VARCHAR2(20),
    JOUR NUMBER(2) NOT NULL,
    JOUR_SEMAINE VARCHAR2(20), 
    EST_WEEKEND NUMBER(1) CHECK (EST_WEEKEND IN (0, 1))
);

CREATE TABLE FAIT_REVIEWS (
    REVIEW_ID VARCHAR2(22) PRIMARY KEY,
    COMMERCE_ID VARCHAR2(22) NOT NULL,
    USER_ID VARCHAR2(22) NOT NULL,
    DATE_ID NUMBER NOT NULL,
    NOTE NUMBER(1) CHECK (NOTE BETWEEN 1 AND 5),
    VOTES_UTILE NUMBER DEFAULT 0,
    VOTES_DROLE NUMBER DEFAULT 0,
    VOTES_COOL NUMBER DEFAULT 0,
    CONSTRAINT FK_REV_COMMERCE FOREIGN KEY (COMMERCE_ID) REFERENCES DIM_COMMERCE(COMMERCE_ID),
    CONSTRAINT FK_REV_USER FOREIGN KEY (USER_ID) REFERENCES DIM_UTILISATEUR(USER_ID),
    CONSTRAINT FK_REV_TEMPS FOREIGN KEY (DATE_ID) REFERENCES DIM_TEMPS(DATE_ID)
);

CREATE TABLE FAIT_FLUX (
    COMMERCE_ID VARCHAR2(22) NOT NULL,
    DATE_ID NUMBER NOT NULL,
    NB_CHECKINS NUMBER DEFAULT 0,
    CONSTRAINT PK_FAIT_FLUX PRIMARY KEY (COMMERCE_ID, DATE_ID),
    CONSTRAINT FK_FLUX_COMMERCE FOREIGN KEY (COMMERCE_ID) REFERENCES DIM_COMMERCE(COMMERCE_ID),
    CONSTRAINT FK_FLUX_TEMPS FOREIGN KEY (DATE_ID) REFERENCES DIM_TEMPS(DATE_ID)
);

CREATE TABLE FAIT_TIPS (
    COMMERCE_ID VARCHAR2(22) NOT NULL,
    USER_ID VARCHAR2(22) NOT NULL,
    DATE_ID NUMBER NOT NULL,
    NB_COMPLIMENTS NUMBER DEFAULT 0,
    CONSTRAINT FK_TIPS_COMMERCE FOREIGN KEY (COMMERCE_ID) REFERENCES DIM_COMMERCE(COMMERCE_ID),
    CONSTRAINT FK_TIPS_USER FOREIGN KEY (USER_ID) REFERENCES DIM_UTILISATEUR(USER_ID),
    CONSTRAINT FK_TIPS_TEMPS FOREIGN KEY (DATE_ID) REFERENCES DIM_TEMPS(DATE_ID)
);