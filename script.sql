DROP TABLE FAIT_MARCHE_LOCAL PURGE;
DROP TABLE FAIT_PERFORMANCE PURGE;
DROP TABLE FAIT_FIDELITE_CLIENT PURGE;
DROP TABLE DIM_PROFIL_CLIENT PURGE;
DROP TABLE DIM_UTILISATEUR PURGE;
DROP TABLE DIM_TEMPS PURGE;
DROP TABLE DIM_COMMERCE PURGE;
DROP TABLE DIM_GEOGRAPHIE PURGE;

CREATE TABLE DIM_GEOGRAPHIE (
    ID_GEO NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ADRESSE VARCHAR2(255),
    VILLE VARCHAR2(100),
    ETAT VARCHAR2(10),
    CODE_POSTAL VARCHAR2(20),
    LATITUDE NUMBER,
    LONGITUDE NUMBER
);

CREATE TABLE DIM_COMMERCE (
    ID_COMMERCE VARCHAR2(50) PRIMARY KEY,
    NOM VARCHAR2(255),
    CATEGORIES VARCHAR2(500),
    GAMME_PRIX NUMBER(1), 
    EST_UNE_CHAINE NUMBER(1), 
    POSSEDE_PARKING NUMBER(1),
    ACCEPTE_RESERVATIONS NUMBER(1)
);

CREATE TABLE DIM_TEMPS (
    ID_TEMPS NUMBER PRIMARY KEY,
    DATE_COMPLETE DATE,
    ANNEE NUMBER,
    MOIS NUMBER,
    TRIMESTRE NUMBER,
    JOUR_SEMAINE VARCHAR2(20)
);

CREATE TABLE DIM_UTILISATEUR (
    ID_UTILISATEUR VARCHAR2(50) PRIMARY KEY,
    NOM VARCHAR2(100),
    EST_ELITE NUMBER(1),
    NB_FANS NUMBER,
    NOTE_MOYENNE_DONNEE NUMBER
);

CREATE TABLE DIM_PROFIL_CLIENT (
    ID_PROFIL NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CATEGORIE_FIDELITE VARCHAR2(50),
    NIVEAU_INFLUENCE VARCHAR2(50),
    TYPE_CONSOMMATEUR VARCHAR2(50) 
);

CREATE TABLE FAIT_PERFORMANCE (
    ID_FAIT NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ID_TEMPS NUMBER REFERENCES DIM_TEMPS(ID_TEMPS),
    ID_GEO NUMBER REFERENCES DIM_GEOGRAPHIE(ID_GEO),
    ID_COMMERCE VARCHAR2(50) REFERENCES DIM_COMMERCE(ID_COMMERCE),
    ID_UTILISATEUR VARCHAR2(50) REFERENCES DIM_UTILISATEUR(ID_UTILISATEUR),
    NOTE_ETOILE NUMBER(2,1),
    LONGUEUR_AVIS NUMBER,     
    NB_VOTES_IMPACT NUMBER,   
    NB_VISITES NUMBER DEFAULT 0
);

CREATE TABLE FAIT_MARCHE_LOCAL (
    ID_MARCHE NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ID_GEO NUMBER REFERENCES DIM_GEOGRAPHIE(ID_GEO),
    ID_TEMPS NUMBER REFERENCES DIM_TEMPS(ID_TEMPS),
    CATEGORIE_ANALYSEE VARCHAR2(100),
    CUMUL_VISITES_ZONE NUMBER,
    NB_ETABLISSEMENTS_ACTIFS NUMBER,
    NB_ETABLISSEMENTS_FERMES NUMBER,
    NOTE_MOYENNE_SECTEUR NUMBER(2,1),
    INDICE_OPPORTUNITE NUMBER(4,2) 
);

CREATE TABLE FAIT_FIDELITE_CLIENT (
    ID_FIDELITE NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ID_TEMPS NUMBER REFERENCES DIM_TEMPS(ID_TEMPS),
    ID_COMMERCE VARCHAR2(50) REFERENCES DIM_COMMERCE(ID_COMMERCE),
    ID_PROFIL NUMBER REFERENCES DIM_PROFIL_CLIENT(ID_PROFIL),
    EST_REVENU NUMBER(1),
    NB_JOURS_DEPUIS_DERNIER_ACHAT NUMBER,
    SCORE_LOYAUTE NUMBER(5,2),
    EST_CLIENT_LOCAL NUMBER(1) 
);

COMMIT;